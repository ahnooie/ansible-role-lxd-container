---
  - name: check if python installed
    raw: dpkg -s python
    register: python_install_check
    failed_when: python_install_check.rc not in [0, 1]
    changed_when: false

  - name: install python
    raw: apt-get install -y python
    when: python_install_check.rc == 1

  - name: set authorized_keys
    authorized_key:
      user: root
      state: present
      key: "{{ public_key }}"
    when: public_key is defined


  - block:
    - name: install openssh-server
      apt:
        name: openssh-server
        state: latest

    - name: start sshd
      systemd: state=started name=sshd
    when: enable_ssh
